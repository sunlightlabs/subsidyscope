
{% extends "base.html" %}
{% load media %}
{% load humanize %}
{% load smarterif%}
{% block content %}
{% js "scripts/swfobject.js" %}
{% js "scripts/json2.js" %}

<style>
#info {padding: 10px; margin: 10px; border: 1px solid #AFAFAF;}
#info ul {margin:0; padding:0;}
#map {height:290px; width: 400px; }
.map-container {width: 45%; float:left;}
.pie-container { width: 50%; margin-right:25px; float:left;}
.info-container { clear:both; display: block; width: 50%; }
.matrix { float:left; width: 480px; }
.matrix td {text-align:right; }
.footnote {font-style:italic; font-size:.8em; float:right; }
</style>
<div class="container main_container">
    {% include "includes/transportation_nav.html" %}
    <span class="span-24">
        <div id="header_area"><h3>{{system.name}}</h3></div>
        <div class="content_area">
            <h5>Funding Sources Over Time</h5>
            <div id="fundingChart"></div>
            <span class="footnote">*Fare data was not collected by the National Transit Database prior to 2002</span>
            
            <div class="pie-container">
                <h5>Funding Sources</h5>
                <div id="sourcesChart"></div>
            </div>
            <div class="map-container">
                <h5>Location</h5>
                <div id="map"></div>
            </div>
            <div class="matrix">
                <h5>Funding Source Comparison</h5>
                <table>
                <tr>
                    <th>Source</th>
                    <th>{{system.common_name}}</th>
                    <th>{{system.urbanized_area.name}}</th>
                    <th>{{system.state}}</th>
                    <th>Overall</th>
                </tr>
                {% for row in matrix_data %}
                <tr>    
                    {% for cell in row %}
                    <td>{% if forloop.counter > 1 %}
                            ${{cell|floatformat:0|intcomma}}
                        {% else %}
                            {{cell}}
                        {% endif %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
                </table>
                
            </div>
            <div class="pie-container" style="width:40%; margin-right:0px;margin-left:65px;">
                <h5>Average Fares Generated by Mode</h5>
                <div id="fareChart"></div>
            </div>
           <!-- <div class="info-container">
                <h5>System Info</h5>
                <div id="info">
                    <ul>
                        <li>Population: {{system.urbanized_area.population|intcomma}}</li>
                        <li>Area: {{system.urbanized_area.area|intcomma}} sq. mi.</li>
                    </ul>
                </div>
            </div>-->
            <!--<div class="pie-container">
                <h5>System Expenses By Mode (Capital and Operating)</h5>
                <div id="modeChart"></div>
            </div>
            <div class="map-container">
                <h5>System Ridership By Mode (PMT)</h5>
                <div id="pmtChart"></div>
            </div>
            <div class="pie-container">
                <h5>System Ridership By Mode (UPT)</h5>
                <div id="uptChart"></div>
            </div>-->

            <h5 style="clear:both;">Operations Info </h5>
            <table style="text-align:right;">
                <tr>
                    <th>Mode</th>
                    <th>Avg Operating Expenses</th>
                    <th>Avg Capital Expenses</th>
                    <th>Avg Revenue Hours</th>
                    <th>Avg Revenue Miles</th>
                    <th>Avg Passenger Miles Travelled</th>
                    <th>Avg Unlinked Passenger Trips</th>
                </tr>
            {% for o in mode_operations %}
                <tr>
                <td>{{o.mode}}</td>
                <td>${{o.op_exp|floatformat:0|intcomma}}</td>
                <td>${{o.cap_exp|floatformat:0|intcomma}}</td>
                <td>{{o.vrh|floatformat:0|intcomma}}</td>
                <td>{{o.vrm|floatformat:0|intcomma}}</td>
                <td>{{o.pmt|floatformat:0|intcomma}}</td>
                <td>{{o.upt|floatformat:0|intcomma}}</td>
                </tr>
            {% endfor %}
            </table>
            

            <script type="text/javascript" charset="utf-8">
                function linechart(){
                    return JSON.stringify({{fund_line_data|safe}});
                }
                function piechart(){
                    return JSON.stringify({{fund_pie_data|safe}});
                }
                function farechart(){
                    return JSON.stringify({{fares_data|safe}});
                }
                /*function modechart(){
                    return JSON.stringify({{fund_mode_data|safe}});
                }
                function pmtchart(){
                    return JSON.stringify({{pmt_data|safe}});
                }
                function uptchart(){
                    return JSON.stringify({{upt_data|safe}});
                }*/
                swfobject.embedSWF("/media/scripts/open-flash-chart.swf", "fundingChart", "900", "300", "9.0.0", "expressInstall.swf", {"get-data": "linechart"});
                swfobject.embedSWF("/media/scripts/open-flash-chart.swf", "sourcesChart", "450", "305", "9.0.0", "expressInstall.swf", {"get-data": "piechart"});
                swfobject.embedSWF("/media/scripts/open-flash-chart.swf", "fareChart", "350", "305", "9.0.0", "expressInstall.swf", {"get-data":"farechart"});
/*              
                swfobject.embedSWF("/media/scripts/open-flash-chart.swf", "modeChart", "450", "305", "9.0.0", "expressInstall.swf", {"get-data": "modechart"});
                swfobject.embedSWF("/media/scripts/open-flash-chart.swf", "pmtChart", "450", "305", "9.0.0", "expressInstall.swf", {"get-data": "pmtchart"});
                swfobject.embedSWF("/media/scripts/open-flash-chart.swf", "uptChart", "450", "305", "9.0.0", "expressInstall.swf", {"get-data": "uptchart"});
  */          </script>
            <script src="http://www.google.com/jsapi?key=ABQIAAAAhsWrZ8VHxDxF9jrKbcsQ0xRvfLFziSZqANDNArw6yp0kxlhceBS-wjqDyDClpSNt9y_iJB5a-HjMig" type="text/javascript" charset="utf-8"></script>
            <script type="text/javascript" charset="utf-8">
                google.load("maps", "2");
            </script>
            <script type="text/javascript" charset="utf-8"> 
                function init() {
                    
                    //var mapoptions = { zoom: 11, mapTypeId: google.maps.MapTypeId.ROADMAP};
                    var map =  new GMap2(document.getElementById("map"));
                    var geocoder = new GClientGeocoder();

                    geocoder.getLatLng('{{system.city}}, {{system.state.abbreviation}}', function(point){
                        map.setCenter(point, 11);
                        var marker = new GMarker(point);
                        map.addOverlay(marker);
                        map.addControl(new GSmallMapControl());
                        //marker.openInfoWindowHTML('{{system.city}}, {{system.state.abbreviation}}');
                    });
                }

                init();
            </script>

        </table>

        </div>
    </span>

</div>

{% endblock content %}
