{% extends "base_tarp.html" %}
{% load media %}
{% load bailout_tags %}
{% load morsel_tags %}
{% load glossary_tags %}


{% block additional_css %}
	{% css "ui.theme.css" %}
{% endblock %}

{% block additional_js %}

	{% js "jquery.autocomplete.js" %}
	
	{% js "swfobject.js" %}
	
{% endblock %}

{% block content %}

<script type="text/javascript">

$(document).ready(function(){
	swfobject.embedSWF('{% media_url %}/scripts/MapVis.swf?v=4', 'mapVis', 800, 650, '9.0.0', '{% media_url %}/scripts/playerProductInstall.swf', {}, {wmode:'transparent'});
	
	$('#tarpFilterInput').autocomplete('/projects/bailout/tarp/map/filter/institution/', {
		width: 260,
		selectFirst: true});
	
	function findValueCallback(event, data, formatted) {
		if (data)
		{
			if(this != false)
			{
				var show = {}
				
				var id = data[1];
				
				showBankShare(id);
			}
			else
			{	
			
			}
		
		}
		else
		{	
	
		}
	}
	
	
	$("#tarpFilterInput").result(function(event, data, formatted) {
		if (data)
		{
			if(this != false)
			{
				var show = {}
				
				var id = data[1];
				
				showBankShare(id, $('#tarpFilterInput').val());
				
			}
			else
			{	

			}
		
		}

	});
	
	$("#tarpFilterInput").blur(function() {
		
		if($("#tarpFilterInput").val() == '')
		{
			$("#tarpFilterInput").addClass('pre_input');
			$("#tarpFilterInput").val('Enter company name');
			
			lastSearch = '';
		}
	});
	
	$("#tarpFilterInput").focus(function() {
		if($("#tarpFilterInput").hasClass('pre_input'))
		{
			$("#tarpFilterInput").removeClass('pre_input');
			$("#tarpFilterInput").val('');
		}
	});
	
	
	$("select[@name='dataType']").change(
		function()
		{
			if ($("select[@name='dataType']").val() == 'branches')
			{	
				showBranches();
			}
			else if ($("select[@name='dataType']").val() == 'deposits')
			{
				showDeposits();
			}
			else if ($("select[@name='dataType']").val() == 'lending')
			{
				showLending();
			}
			
		});
	
	$("input[@name='filterType']").click(
		function()
		{
			if ($("input[@name='filterType']:checked").val() == 'all')
			{
				$(".group").toggleClass("group_vert");
				$('#tarpFilterInput').hide();
				$("#tarpFilterInput").removeClass('pre_input');
				$("#tarpFilterInput").val('');
				
				
				showTARPShare(); 
			}
			else if ($("input[@name='filterType']:checked").val() == 'filter')
			{
				$("#tarpFilterInput").addClass('pre_input');
				$("#tarpFilterInput").val('Enter company name');
				$('#tarpFilterInput').show();
				
				showBankShare(-1);
			}
			$(this).blur();
		});
	$("input[@value='all']").attr('checked','checked');
	$("select[@name='dataType']").val('deposits');
	$("#tarpFilterInput").removeClass('pre_input');
	$("#tarpFilterInput").val('Enter company name');
	$('#tarpFilterInput').hide();
	
	
});

function showBankShare(bank_id, bank_name)
{
	var flex = null;
	flex = getFlexMovie("mapVis");
	if((flex!=null) && (flex.loadBankShare!=null))
	    flex.loadBankShare(bank_id, bank_name);	
}

function showTARPShare()
{
	var flex = null;
	flex = getFlexMovie("mapVis");
	if((flex!=null) && (flex.loadTARPShare!=null))
	    flex.loadTARPShare();	
}


function showBranches()
{
	var flex = null;
	flex = getFlexMovie("mapVis");
	if((flex!=null) && (flex.showBranches!=null))
	    flex.showBranches();	
}

function showDeposits()
{
	var flex = null;
	flex = getFlexMovie("mapVis");
	if((flex!=null) && (flex.showDeposits!=null))
	    flex.showDeposits();	
}

function showLending()
{
	var flex = null;
	flex = getFlexMovie("mapVis");
	if((flex!=null) && (flex.showLending!=null))
	    flex.showLending();	
}

function getFlexMovie(movieName) {
    if (navigator.appName.indexOf("Microsoft") != -1) {
        return window[movieName]
    }
    else {
        return document[movieName]
    }
}




</script>


<div class="container main_container">
	{% include "includes/bailout_nav.html" %}
	<div class="span-24">
		<div id="header_area">
			<h2>{% morsel_sector_title %}</h2>
			<h3>{% morsel_page_title %}</h3>		
		</div>
		<div id="content_area">
			{% morsel text1 %}
		</div>		
	
		<div class="non_content">		

				<div id="table-filter" style="clear:left; margin: 25px;">

				<p><input type="radio" name="filterType" value="all" checked/> Show all TARP Recipients</p>
				<p><input type="radio" name="filterType" value="filter"/> Filter by TARP Recipient: <input size="30" id="tarpFilterInput"/></p>


				View share of: <select name="dataType">
					<option value="branches">Branches</option>
					<option value="deposits">Deposits</option>
					<option value="lending">Lending (2007 HMDA)</option>
				</select>

				</div> 

				<div id="map-container"  style="padding: 0 20px; margin: 25px 0; border: 1px solid #D3D3D3;">
				
					{% morsel caption %}
					
					<div id="table-filter" style="clear:left; margin-left: 25px; float: left;">
				
						<p><input type="radio" name="filterType" value="all" checked/> Show all TARP Recipients</p>
						<p><input type="radio" name="filterType" value="filter"/> Filter by TARP Recipient: <input size="30" id="tarpFilterInput" value="Enter company name" class="pre_input"/></p>
					
					</div>	
					
					<div style="float: right;  margin-right: 25px;">
						View share of: <select name="dataType">
							<option value="branches">Branches (2008 FDIC)</option>
							<option value="deposits">Deposits (2008 FDIC)</option>
							<option value="lending">Lending (2007 HMDA)</option>
						</select>
					</div>
					
					<br clear="all"/> 
					
					<div style="margin-left: 50px;">
						<div id="mapVis" >
							<p>To view this content, JavaScript must be enabled, and you need the latest version of the Adobe Flash Player.</p>
							
							<a href="http://www.adobe.com/go/getflashplayer" class="noHover" target="_top"><img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash Player" border="0" width="112" height="33"></a>
						
						</div>
					</div>
					
					<br clear="all"/>
										
				</div>
		</div>
	
		<div id="content_area">	
			{% morsel text2 %} 
		</div>
	
	</div>
	
</div>
			
{% endblock %}