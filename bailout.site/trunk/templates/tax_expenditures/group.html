{% extends "base.html" %}

{% load media %}
{% load morsel_tags %}
{% load te_tags %}

{% block content %}


<script>
function reloadPage()
{
	$("#loaderForm").submit();
}

function changeYear(year)
{
	$("#displayYear").val(year)
	$("#loaderForm").submit();
	return false;
}

function toggleLine(line_id)
{
	var source_elem = $('#' + line_id + '_source')[0];

	if(source_elem && source_elem.style.display == 'none')
	{
	     $('#' + line_id + '_source').show();
	     $('#' + line_id + '_toggle').attr('src', '/media/images/collapse_minus.png');
	}
	else
	{
	     $('#' + line_id + '_source').hide();
	     $('#' + line_id + '_toggle').attr('src', '/media/images/collapse_plus.png');
	}     
	     
	     
	var footnote_elem = $('#' + line_id + '_footnotes')[0];

	if(footnote_elem && footnote_elem.style.display == 'none')
	     $('#' + line_id + '_footnotes').show();
	else
	     $('#' + line_id + '_footnotes').hide();                       

	return false;
}

</script>

<div class="container main_container">
    {% include "includes/pted_group_nav.html" %}
    <div class="span-24">
        <div id="header_area">
            <h3>Pew's Tax Expenditure Database</h3>
        </div>
        <div class="content_area">
             	
        	<h5 style="margin-top:20px;">{{ group.name }}</h5> 
        
        	{{ group.description|safe }}
        	
        	
        	
        	<div style="float: right; text-align: right;">
        		<a href="{% url tax_expenditures-csv group.id %}">Download data as CSV file</a>
        	</div>
        	<br clear="all"/>
        	<div style="float: right; text-align: right;">
        
        	<form id="loaderForm" action="{% url tax_expenditures-group group.id %}" method="GET" style="margin-bottom: 5px;">
        		<strong>Display estimates for: </strong><select name="estimate" id="displayEstimate" onchange="reloadPage();"><option value="3" {% ifequal estimate 3 %}selected{% endifequal %}>Corporations & Individuals</option><option value="1" {% ifequal estimate 1 %}selected{% endifequal %}>Corporations</option><option value="2" {% ifequal estimate 2 %}selected{% endifequal %}>Individuals</option></select>
        		
        		<strong>Show years: </strong><select name="year" id="displayYear" onchange="reloadPage();">{% for choice in year_choices %}<option value="{{ choice.value }}" {% ifequal year choice.value %}selected{% endifequal %}>{{ choice.label }}</option>{% endfor %}</select>
        	</form>
        	</div>
        
        	
        	<strong>Summary ($ millions)<a href="#footnote-1" class="footnote">1</a></strong><br/>
        	<div id="subsidy-charts"  style="margin-bottom: 35px;"> 
				<table>				
				<tbody style="border-right: 1px solid #999;">
					<tr class="header-row"> 
					  <td style="border-left: 1px solid #999;">&nbsp;</td>
					  {% for year in estimate_years %}<td style="text-align: right; {% if forloop.last  %} border-right: 1px solid #999;{% endif %}">{% if forloop.first  %}{% if previous_year %}<a href="#" onclick="changeYear({{ previous_year }}); return false;"><img style="vertical-align: top;" src="/media/images/scroll_left.png"/></a>&nbsp;{% endif %}{% endif %}{{year}}{% if forloop.last  %}{% if next_year %}<a href="#" onclick="changeYear({{ next_year }}); return false;"><img style="vertical-align: top;" src="/media/images/scroll_right.png"/></a>{% endif %}{% endif %}</td>{% endfor %}
					 
					</tr>
					
					{% te_group_summary group source estimate estimate_years %}

				</tbody>
				</table>
			</div>  	
        
        {% if subgroups%}
        	<strong>{{ group.name }} Tax Expenditures ($ millions)</strong><br/>
        	<div id="subsidy-charts"  style="margin-bottom: 35px;"> 
				<table>
				
				<tbody style="border-right: 1px solid #999; border-left: 1px solid #999;">
				
					<tr class="header-row"> 
					  <td style="border-left: 1px solid #999;">&nbsp;</td>
					  {% for year in estimate_years %}<td style="text-align: right;{% if forloop.last  %} border-right: 1px solid #999;{% endif %}">{{year}}</td>{% endfor %}
					 
					</tr>
				
					{% for subgroup in subgroups %}
						
						<tr><td style="text-align: left; border-right: 1px solid #999; border-left: 1px solid #999; border-top: solid 1px #999; border-bottom: solid 1px #ccc;" colspan="15"><strong><a href="{% url tax_expenditures-group subgroup.id %}?estimate={{ estimate }}&year={{ year }}">{{ subgroup.name }}</a></td></tr>
						
						{% te_group_summary subgroup source estimate estimate_years %}
						
					{% endfor %}
				
				</tbody>
				</table>
				
			</div>
		{% endif %}
		
		{% if group.parent %}
	        {% te_expenditure_detail group report_years estimate_years estimate 'Treasury' %}      
	        	
	        {% te_expenditure_detail group report_years estimate_years estimate 'JCT' %}    
	    {% endif %}
		
		<cite>
		* Contains estimates between -$50 million and $50 million, rounded to zero in total.
		</cite>
		
		<br/>
		
		<cite>
		&dagger; Click the plus next to the report year to see footnote from source document.
		</cite>
		
		<br/>
		<br/>

		<cite>
		Notes: Report years, presented along the vertical axis (varying down the rows) correspond to the year of the budget of document in which the estimates were obtained. Estimate years, presented along the horizontal axis (varying across the columns), correspond to the years of estimates within a specific budget or document.
		</cite>
		
		<br/>
		<br/>
		
		<cite>
		Descriptions of tax expenditures are from OMB, <i><u>Analytical Perspectives.</u></i> OMB. Budget of the U.S. Government, Fiscal Year 2011. pp. 224-240.
		</cite>
		
		<br/>
		<br/>
		
		<ol class="footnotes">
			<li><a name="footnote-1"></a>Summing tax expenditures often provides a reasonably good estimate for the total cost of groups of tax expenditures, though it does not capture the potential interactions among tax expenditures if any single one is changed or repealed.</li>
		</ol>
		
		</div>
	</div>
</div>

{% endblock content %}
