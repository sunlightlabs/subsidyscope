{% extends "base.html" %}

{% load media %}
{% load humanize %}
{% block content %}
{% js "jquery.easing.1.3.js" %}
<style>
#portsearch input.term {
    width: 27%;
    margin-left: 3px;
}
#portsearch label {
    font-weight: normal;
}
#portsearch, #statesearch {
    margin: 20px 0px;
}
#portsearch .submit, #statesearch .submit {
    background-color: #F6F8FB;
    border: 1px solid #899EAB;
    font-size: .8em;
    padding: 0 3px;
    margin-left: 15px;
}
#statesearch { display: inline; }
.searchterms, .options {
    margin-top: 15px;
    padding-left: 15px;
}
.options select {
    font-size: .9em;
}
.searchterms span {
    margin: 0 20px;
}
#results {
    margin-top:20px;
    border-top: 1px solid #EFEFEF;
}
ul.headers li{
    float:left;
    width: 17%;
    text-align: center;
    font-size: .9em;
    padding: 4px;
}
ul.headers li.name, .portdetail ul li.name {
    width: 30%;
    text-align:left;
}
.portdetail ul li.icon { width: 1%; }
.portdetail ul li.icon a {
    display: block;
    height: 17px;
    width: 17px;
    background: url("/media/images/icon_open.png") no-repeat top left ;
}
.portdetail ul li.icon a.close{
    background: url("/media/images/icon_close.png") no-repeat top left;
}
.portdetail table {
    margin-left:20px;
    width: 96%;
    clear:both;
}
.portdetail table td.desc {
    width:100%;
}
ul.headers {
    border: 1px solid #1D235F;
    float:left;
    width: 100%;
    margin-left: 0px;
    margin-bottom: 5px;
}
.portdetail{
    float:left;
    width: 100%;
    padding-top: 10px;
}
.portdetail ul.sum {
    border-top: 1px solid #1D235F;
    padding-top: 15px;
}
.portdetail ul {
    float:left;
    width: 100%;
    margin-left: 0px;
    margin-bottom: 5px;
}
.portdetail ul li {
    float: left;
    width: 16%;
    text-align: center;
    padding: 0 5px;
}
.portdetail ul li.city{
    padding-left: 10px;
}
.portdetail ul li.st {
    padding-left: 10px
}
.even {
    background-color: #EFEFEF;
}
</style>
<script type="text/javascript" charset="utf-8">
(function($){
    $(document).ready(function(){
        $("#results").click( function(e) {
            var that = $(e.target);
            if( that.hasClass("icon") || that.parents("li").hasClass("icon")){
                if(that.is("a")) { that = that.parents("li");}
                var port = $(that).attr("name");   
                var link = $(that).children("a");
                if(link.hasClass("close")){
                    link.removeClass("close");
                    $(that).parent("ul").siblings("table").slideUp("normal", function(){$(this).remove();});
                    return false;
                }
                port = port.replace(/[+]/, "%2B");
                $.ajax({
                    'data': "code="+port,
                    'dataType': 'html',
                    'url': '/projects/transportation/aip/detail',
                    'success': function(html){
                        $(that).closest("div.portdetail").append(html).find("table").slideDown("fast");
                        $("a", $(that)).addClass("close");
                    },
                    'error': function(xhr, textstatus){
                    }
                });
                return false;
            } else { return false; }
        });
    });    
})(jQuery);
</script>
<div class="container main_container">
    {% include "includes/transportation_nav.html" %}
    <span class="span-24">
        <div id="header_area"><h3>Airport Improvement Program Grant Search</h3></div>
        <div class="content_area">
        <p> Some information about AIP and how to use the search goes here maybe. </p>
        <form id="portsearch">
            <strong>Search by: </strong>
            <span class="searchterms"><label>Airport Name:</label><input class="term" type="text" name="portname" /><span><em> &mdash; or &mdash;</em></span><label>Airport Code:</label><input class="term" type="text" name="portcode" /><input type="submit" class="submit" value="Search"/></span>
            <!--<span class="options"><label>filter by year: </label><select name="yearfilter"><option value="all">All available</option><option value="2005">2005</option><option value="2006">2006</option><option value="2007">2007</option><option value="2008">2008</option></select>-->
        </form>
        <form id="statesearch">
            <strong>Select grant funding by state:</strong>
            <span class="options"><select name="state">
    <option value="AL">Alabama</option>
    <option value="AK">Alaska</option>
    <option value="AZ">Arizona</option>
    <option value="AR">Arkansas</option>
    <option value="CA">California</option>
    <option value="CO">Colorado</option>
    <option value="CT">Connecticut</option>
    <option value="DE">Delaware</option>
    <option value="DC">District of Columbia</option>
    <option value="FL">Florida</option>
    <option value="GA">Georgia</option>
    <option value="HI">Hawaii</option>
    <option value="ID">Idaho</option>
    <option value="IL">Illinois</option>
    <option value="IN">Indiana</option>
    <option value="IA">Iowa</option>
    <option value="KS">Kansas</option>
    <option value="KY">Kentucky</option>
    <option value="LA">Louisiana</option>
    <option value="ME">Maine</option>
    <option value="MD">Maryland</option>
    <option value="MA">Massachusetts</option>
    <option value="MI">Michigan</option>
    <option value="MN">Minnesota</option>
    <option value="MS">Mississippi</option>
    <option value="MO">Missouri</option>
    <option value="MT">Montana</option>
    <option value="NE">Nebraska</option>
    <option value="NV">Nevada</option>
    <option value="NH">New Hampshire</option>
    <option value="NJ">New Jersey</option>
    <option value="NM">New Mexico</option>
    <option value="NY">New York</option>
    <option value="NC">North Carolina</option>
    <option value="ND">North Dakota</option>
    <option value="OH">Ohio</option>
    <option value="OK">Oklahoma</option>
    <option value="OR">Oregon</option>
    <option value="PA">Pennsylvania</option>
    <option value="RI">Rhode Island</option>
    <option value="SC">South Carolina</option>
    <option value="SD">South Dakota</option>
    <option value="TN">Tennessee</option>
    <option value="TX">Texas</option>
    <option value="UT">Utah</option>
    <option value="VT">Vermont</option>
    <option value="VA">Virginia</option>
    <option value="WA">Washington</option>
    <option value="WV">West Virginia</option>
    <option value="WI">Wisconsin</option>
    <option value="WY">Wyoming</option>
    </select>
    <input type="submit" class="submit" value="go" />
</span>
</form>
        {% if error %}
            {{error}}
        {% endif %}
 
        {% if grants %}
        <div id="results">
            <ul class="headers">
            <li class="name">Airport Name</li><li>Total Grants (2005-09)</li><li>City</li><li>State</li>
            </ul>

            {% for port in grants %}
                <div class="portdetail{% if forloop.counter|divisibleby:"2"  %} even {%endif%}">
                <ul>
                <li class="name">{{port.0.name}}</li><li>
                ${{port.1|intcomma}}
                </li><li class="city">{{port.0.city}}</li><li class="st">{{port.0.state}}</li>
                <li class="icon" name="{{port.0.code}}"><a class="more" href="#"><!--show more --></a></li>
                </ul>
                </div>
            {% endfor %}
            {% ifequal type "state" %}
                {% if blockgrants %}
                <div class="portdetail"><ul><li class="name">Total state block grants:</li><li>${{blockgrants|intcomma}}</li></ul>
                {% endif %}
                {% if total %}
                 <div class="portdetail"><ul class="sum"><li class="name">Total grant money for state:</li><li>${{total|add:blockgrants|intcomma}}</li></ul></div>
                {% endif %}
            {% endifequal %}
        </div>
        {% endif %} 

        </div>
    </span>
</div>

{% endblock %}
