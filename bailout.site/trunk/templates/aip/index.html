{% extends "base.html" %}

{% load media %}
{% load humanize %}
{% block content %}
{% js "jquery.easing.1.3.js" %}
<style>
#portsearch input.term {
    width: 27%;
    margin-left: 3px;
}
#portsearch label {
    font-weight: normal;
}
#portsearch, #statesearch {
    margin: 20px 0px;
}
#portsearch .submit, #statesearch .submit {
    background-color: #F6F8FB;
    border: 1px solid #899EAB;
    font-size: .8em;
    padding: 0 3px;
    margin-left: 15px;
}
#statesearch { display: inline; }
.searchterms, .options {
    margin-top: 15px;
    padding-left: 15px;
}
.options select {
    font-size: .9em;
}
.searchterms span {
    margin: 0 20px;
}
#results {
    margin-top:20px;
    border-top: 1px solid #EFEFEF;
}
ul.headers li{
    float:left;
    width: 15%;
    text-align: center;
    font-size: .9em;
    padding: 4px;
}
ul.headers li.name, .portdetail ul li.name {
    width: 30%;
    text-align:left;
}
ul.headers li.money, .portdetail ul li.money, .portdetail ul li.enps, ul.headers li.enps {
    text-align:right;
    width: 15%;
}
.portdetail ul li.enps {padding-right:30px;}
.portdetail ul li.city {text-align:left; width:11%;}
.portdetail ul li.st, ul.headers li.st {width:5%; padding-left:6%;}
.portdetail table {
    margin-left:0px;
    width: 96%;
    clear:both;
}
.portdetail table td.desc {
    width:100%;
}
ul.headers {
    border: 1px solid #1D235F;
    float:left;
    width: 100%;
    margin-left: 0px;
    margin-bottom: 5px;
}
.portdetail{
    float:left;
    width: 100%;
    padding-top: 10px;
}
.portdetail ul.sum {
    border-top: 1px solid #1D235F;
    padding-top: 15px;
}
.portdetail ul {
    float:left;
    width: 100%;
    margin-left: 0px;
    margin-bottom: 5px;
}
.portdetail ul li {
    float: left;
    width: 16%;
    text-align: center;
    padding: 0 5px;
}
.even {
    background-color: #EFEFEF;
}
.bold {
    font-weight: bold;
}
ul.portstats li {float:none; width:auto;}
ul.portstats {border: 1px solid black; background-color:white; }
h5.left, h5.right {font-size: 1.1em;}
h5.left {width: 34%; float:left; }
h5.right {width:45%; float:left;}
.data-container {float:left; margin-left:30px; }
.enplanement-data {width: 280px; float:left;}
.enplanement-data table td{text-align:right;}
</style>
<script type="text/javascript" charset="utf-8">
(function($){
    $(document).ready(function(){
        $("#results").click( function(e) {
            var that = $(e.target);
            if( that.parents("li").hasClass("name")){
                if(that.is("a")) { that = that.parents("li");}
                var port = $(that).attr("name");   
                
                if(that.hasClass("close")){
                    that.removeClass("close");
                    that.removeClass("bold");
                    $(that).parent("ul").siblings("div.data-container").slideUp("normal", function(){$(this).remove();});
                    return false;
                }
                port = port.replace(/[+]/, "%2B");
                $.ajax({
                    'data': "code="+port,
                    'dataType': 'html',
                    'url': '/projects/transportation/aip/detail',
                    'success': function(html){
                        $(that).closest("div.portdetail").append(html).find("div.data-container").slideDown("fast");
                        $(that).addClass("close");
                        $(that).addClass("bold");
                    },
                    'error': function(xhr, textstatus){
                    }
                });
                return false;
            } else { return false; }
        });
    });    
})(jQuery);
</script>
<div class="container main_container">
    {% include "includes/transportation_nav.html" %}
    <span class="span-24">
        <div id="header_area"><h3>Airport Improvement Program Grant Search</h3></div>
        <div class="content_area">
        <p>The Airport Improvement Program is a <a href="/projects/transportation/direct-expenditures/programs/">CFDA program</a> that administers grants to airports around the country. Use the search options below to look up grant funding and enplanement<sup>1</sup> data by state or airport.</p>
        <form id="portsearch">
            <strong>Search by: </strong>
            <span class="searchterms"><label>Airport Name:</label><input class="term" type="text" name="portname" /><span><em> &mdash; or &mdash;</em></span><label>Airport Code:</label><input class="term" type="text" name="portcode" /><input type="submit" class="submit" value="Search"/></span>
            <!--<span class="options"><label>filter by year: </label><select name="yearfilter"><option value="all">All available</option><option value="2005">2005</option><option value="2006">2006</option><option value="2007">2007</option><option value="2008">2008</option></select>-->
        </form>
        <form id="statesearch">
            <strong>Select grant funding by state:</strong>
            <span class="options"><select name="state">
    <option value="AL">Alabama</option>
    <option value="AK">Alaska</option>
    <option value="AZ">Arizona</option>
    <option value="AR">Arkansas</option>
    <option value="CA">California</option>
    <option value="CO">Colorado</option>
    <option value="CT">Connecticut</option>
    <option value="DE">Delaware</option>
    <option value="DC">District of Columbia</option>
    <option value="FL">Florida</option>
    <option value="GA">Georgia</option>
    <option value="HI">Hawaii</option>
    <option value="ID">Idaho</option>
    <option value="IL">Illinois</option>
    <option value="IN">Indiana</option>
    <option value="IA">Iowa</option>
    <option value="KS">Kansas</option>
    <option value="KY">Kentucky</option>
    <option value="LA">Louisiana</option>
    <option value="ME">Maine</option>
    <option value="MD">Maryland</option>
    <option value="MA">Massachusetts</option>
    <option value="MI">Michigan</option>
    <option value="MN">Minnesota</option>
    <option value="MS">Mississippi</option>
    <option value="MO">Missouri</option>
    <option value="MT">Montana</option>
    <option value="NE">Nebraska</option>
    <option value="NV">Nevada</option>
    <option value="NH">New Hampshire</option>
    <option value="NJ">New Jersey</option>
    <option value="NM">New Mexico</option>
    <option value="NY">New York</option>
    <option value="NC">North Carolina</option>
    <option value="ND">North Dakota</option>
    <option value="OH">Ohio</option>
    <option value="OK">Oklahoma</option>
    <option value="OR">Oregon</option>
    <option value="PA">Pennsylvania</option>
    <option value="RI">Rhode Island</option>
    <option value="SC">South Carolina</option>
    <option value="SD">South Dakota</option>
    <option value="TN">Tennessee</option>
    <option value="TX">Texas</option>
    <option value="UT">Utah</option>
    <option value="VT">Vermont</option>
    <option value="VA">Virginia</option>
    <option value="WA">Washington</option>
    <option value="WV">West Virginia</option>
    <option value="WI">Wisconsin</option>
    <option value="WY">Wyoming</option>
    </select>
    <input type="submit" class="submit" value="go" />
</span>
</form>
<div style="margin-top:10px;"><cite><sup>1</sup>An enplanement, as defined by the FAA, is a single, revenue-generating passenger departing from or arriving at an airport.</cite></div>
        {% if error %}
           <span class="error"> {{error}}</span>
        {% endif %}
 
        {% if grants %}
        <div id="results">
            <ul class="headers">
            <li class="name">Airport Name</li><li class="money">Total Grants (2005-09)</li><li class="enps">Total Enplanements</li><li>City</li><li class="st">State</li>
            </ul>

            {% for port in grants %}
                <div class="portdetail{% if forloop.counter|divisibleby:"2"  %} even {%endif%}">
                <ul>
                <li class="name" name="{{port.0.code}}"><a href="#">{{port.0.name}}</a></li>
                <li class="money">${{port.1|floatformat|intcomma}}</li>
                <li class="enps">{{port.2|intcomma}}</li>
                <li class="city">{{port.0.city}}</li><li class="st">{{port.0.state}}</li>
                </ul>
                </div>
            {% endfor %}
            {% ifequal type "state" %}
                {% if blockgrants %}
                <div class="portdetail"><ul><li class="name">Total state block grants:</li><li class="money">${{blockgrants|floatformat:0|intcomma}}</li></ul>
                {% endif %}
                {% if total %}
                 <div class="portdetail"><ul class="sum"><li class="name">Total grant money for state:</li><li class="money">${{total|add:blockgrants|intcomma}}</li></ul></div>
                {% endif %}
            {% endifequal %}
        </div>
        {% endif %} 

        </div>
    </span>
</div>

{% endblock %}
