{% extends "base.html" %}
{% load media %}
{% load morsel_tags %}
{% load webdesign %}
{% load humanize %}
{% load search_tags %}

{% block additional_css %}
{# {% css "arc90_multiselect.css" %} #}
{% css "jquery-ui/ui.all.css" %}
{% css "faads-search.css" %}
{% endblock %}

{% block additional_js %}

  {# {% js "arc90_multiselect.js" %} #}
	{% js "ui.core.js" %}
	{% js "ui.tabs.js" %}
	{% js "ui.datepicker.js" %}
	
	{% js "swfobject.js" %}
	{% js "faads-search.js" %}
	
	<!-- if JS is available, hide divs -->
	<script type="text/javascript">
	document.write('<style type="text/css">.program-selection-target { display: none; }</style>');
	</script>
	
{% endblock %}

{% block content %}

<div class="container main_container">
    {% include "includes/transportation_nav.html" %}
    <div class="span-24">
        <div id="header_area">
            <h3>{% morsel_page_title %}</h3>
        </div>
        <div class="content_area">    
	
					<p>{% morsel text1 %}</p>
	
					<form action="{% url faads.views.search %}" method="POST" id="faads-search-form">

					<fieldset{% if ran_search %} class="collapsed"{% endif %} id="text-query-wrapper">
					  <legend>Text</legend>
						<div id="text-query-text-wrapper">{{ form.text_query }}{{ form.text_query.errors }}</div>
						<div id="text-query-type-wrapper">{{ form.text_query_type }}{{ form.text_query_type.errors }}</div>
					</fieldset>


          <fieldset{% if ran_search %} class="collapsed"{% endif %}>
            <legend>Select Programs</legend>

            <p>Choose programs by: <span id="program-selector">{{ form.cfda_program_selection_method }}</span></p>
              <!--<div id="program-selector"><span><input type="radio" name="program-selection-type" value="tag">&nbsp;Tag</span><span><input type="radio" name="program-selection-type" value="subsector">&nbsp;Mode</span><span><input type="radio" name="program-selection-type" value="program">&nbsp;Individual Program</span></div>-->

            </p>
            <div id="program-selection-tag" class="program-selection-target">
              <p>Subsidyscope assigns "tags" to each program to classify the functions it is designed to perform (for more detail, see our <a href="{% url methodology %}">methodology section</a>). Choosing a tag will select the set of programs associated with that function. You may also choose whether to only include programs with the selected tag(s) as their primary function, or all programs that are related to the tag.</p>

              {{ form.tags_1 }}
              {{ form.tags_2 }}
              {{ form.tags_3 }}
              {{ form.tags_1.errors }}{{ form.tags_2.errors }}{{ form.tags_3.errors }}
              
              <p style="clear:left; padding-top: 1.5em">{{ form.tags_exclude_secondary }}&nbsp;Only include programs having the selected tag(s) as their primary function</p>
            </div>
            
            {% if form.subsectors_1 %}
            <div id="program-selection-subsector" class="program-selection-target">
              {{ form.subsectors_1 }}
              {{ form.subsectors_2 }}
              {{ form.subsectors_3 }}
              {{ form.subsectors_1.errors }}{{ form.subsectors_2.errors }}{{ form.subsectors_3.errors }}
            </div>
            {% endif %}

            <div id="program-selection-program" class="program-selection-target">
              {{ form.cfda_programs_1 }}
              {{ form.cfda_programs_2 }}
              {{ form.cfda_programs_1.errors }}{{ form.cfda_programs_2.errors }}
            </div>

          </fieldset>

          <fieldset{% if ran_search %} class="collapsed"{% endif %}>
            <legend>Expenditure Type</legend>

  					<div class="field-wrapper" id="assistance-action-recipient-wrapper">
  						<div class="dropdown-wrapper">
  						  <label for="assistance_type">Assistance Type</label>
  							{{ form.assistance_type }}
  							{{ form.assistance_type.errors }}
  						</div>
  						<div class="dropdown-wrapper">
  						  <label for="action_type">Action Type</label>
  							{{ form.action_type }}
  							{{ form.action_type.errors }}
  						</div>
  						<div class="dropdown-wrapper">
  						  <label for="recipient_type">Recipient Type</label>
  							{{ form.recipient_type }}
  							{{ form.recipient_type.errors }}
  						</div>
  					</div>			
					</fieldset>
					
					<fieldset{% if ran_search %} class="collapsed"{% endif %}>
					  <legend>Expenditure Range</legend>
  					<div class="field-wrapper">
    					<div id="obligation-date-wrapper">
    					  <label for="obligation_date_start">Obligation Date</label>
    					  <div class="range-wrapper">
    						{{ form.obligation_date_start }}&nbsp;to&nbsp;{{ form.obligation_date_end }}
    						{{ form.obligation_date_start.errors }}
    						{{ form.obligation_date_end.errors }}
    						</div>
    						{# fiscal year ? #}
    					</div>
					
    					<div id="obligation-amount-wrapper">
    					  <label for="obligation_amount_minimum">Obligation Amount</label>
    					  <div class="range-wrapper">
    						$&nbsp;{{ form.obligation_amount_minimum }}&nbsp;to&nbsp;$&nbsp;{{ form.obligation_amount_maximum }}
    						{{ form.obligation_amount_minimum.errors }}
    						{{ form.obligation_amount_maximum.errors }}
    						</div>
    					</div>
            </div>
          </fieldset>
            

					<input type="submit" value="Search" class="faads-search-submit" />
					</form>
				
				    {% if not faads_results and ran_search %}
				      <div id="no-faads-results-found">No records matching your search criteria were found</div>
				    {% endif %}
				    
			      {% if faads_results and ran_search %}		
			      
			      <div class="ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">
          		<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
          			<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#faads-result-table">Results</a></li>
          			<li class="ui-state-default ui-corner-top"><a href="#faads-result-graph">By Year</a></li>
          			<li class="ui-state-default ui-corner-top"><a href="#faads-result-map">By Location</a></li>
          		</ul>
          		
          		<div class="ui-tabs-panel ui-widget-content ui-corner-bottom" id="faads-result-table">
			      		    
				      <table id="faads-search-results">
				        <thead>
				          <tr>
				            <th class="obligation-date">Obligation Date</th>
				            <th class="cfda-program">CFDA Program</th>
				            <th class="recipient-name">Recipient Name</th>
				            <th class="recipient-location">Recipient Location</th>
				            <th class="place-of-performance">Place of Performance</th>
				            <th class="description">Description</th>
                    <th class="amount">Amount</th>                    
				          </tr>
				        </thead>

				        <tbody>
                {% for result in faads_results.object_list %}
                  <tr class="{% cycle "odd" "even" %}" rel="faads_record_id-{{ result.object.record_id }}">
                    <td class="obligation-date">{{ result.object.obligation_action_date }}</td>
                    <td class="cfda-program">{{ result.object.cfda_program.program_number }}</td>
                    <td class="recipient-name">{{ result.object.recipient_name }}</td>
                    <td class="recipient-location">{{ result.object.recipient_city_name }}, {{ result.object.recipient_state_name }}</td>
                    <td class="place-of-performance">{{ result.object.principal_place_county_or_city_name }}, {{ result.object.principal_place_state_name }}</td>
                    <td class="description">{{ result.object.project_description }}</td>
                    <td class="amount">${{ result.object.federal_funding_amount|floatformat:"-0"|intcomma }}</td>
                  </tr>
                {% endfor %}
                </tbody>
              </table>

              <div class="pagination">
                  <span class="step-links">
                      {% if faads_results.has_previous %}
                          <a href="?page={{ faads_results.previous_page_number }}{{ querystring|safe }}">&laquo; previous</a>
                      {% endif %}

                      <span class="current">
                          Page {{ faads_results.number }} of {{ faads_results.paginator.num_pages|intcomma }}
                      </span>

                      {% if faads_results.has_next %}
                          <a href="?page={{ faads_results.next_page_number }}{{ querystring|safe }}">next &raquo;</a>
                      {% endif %}
                  </span>
              </div>

              </div>
              
              <div class="ui-tabs-panel ui-widget-content ui-corner-bottom" id="faads-result-graph">
                <span id="resultsgraph"></span>  
                {% js "json2.js" %}
                <script type="text/javascript" charset="utf-8">
                    var data = {"elements":[{ "type": "bar_3d", "on-show": {"type:":"grow-up"}, "values": [24825876722.00, 26979995636.00, 42134994154.00, 36005167720.00, 31914878758.00, 34682246791.00, 46106012053.00, 45072344099.00, 27756929470.00, 9460538507.00]}], "title": {"text": ""}, "bg_colour": "#FFFFFF", "x_axis": {"3d": 5, "colour": "#909090", "tick-height": 20, "labels": {"labels":["2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009"]}}, "y_axis": {"colour": "#909090", "min": 0, "max": 50000000000.00}, "x_legend": {"text": "Years", "style": "{font-size:12px;}"}, "y_legend":{"text": "US Dollars ($)", "style":"{font-size:12px;}"}};
                    function open_flash_chart_data() {
                        return JSON.stringify(data);
                    }           
                    swfobject.embedSWF("/media/scripts/open-flash-chart.swf", "resultsgraph", "880", "400", "9.0.0", "expressInstall.swf");
                    
                </script>
              </div>
              
              <div class="ui-tabs-panel ui-widget-content ui-corner-bottom" id="faads-result-map">
                  
                  	<div style="float: right;  margin-right: 25px;">
						View: <select name="dataType">
							<option value="counties">Counties</option>
							<option value="counties_pop">Counties (per capita)</option>
							<option value="states">States</option>
							<option value="states_pop">States (per capita)</option>
						</select>
					</div>
					
					<br clear="all"/> 
					
					<div style="margin-left: 50px;">
						<div id="mapVis" >
							<p>To view this content, JavaScript must be enabled, and you need the latest version of the Adobe Flash Player.</p>
							
							<a href="http://www.adobe.com/go/getflashplayer" class="noHover" target="_top"><img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash Player" border="0" width="112" height="33"></a>
						
						</div>
					</div>
                  
                  
              </div>

            </div>
            {% endif %}				
				
        </div>
</div>

{% endblock %}
